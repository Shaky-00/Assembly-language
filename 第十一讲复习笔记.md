### 第十一讲 代码优化

#### 一、概述

算法优化是在时间复杂度和空间复杂度上进行的

代码优化的上限：算法本身；处理器的微结构

#### 二、常规优化

**代码外提**

如果一段代码在循环内重复执行，并且每次都产生相同的结果，则这段代码可以提到循环外执行，以减少执行次数。

**强度削弱**

不同的运算延迟不同（加减逻辑一般是一拍延迟，乘法2~3拍，除法几~十几拍）

强度削弱就是用简单的操作代替复杂的操作（例如移位代替乘除）

**共享公共子表达式**

将公共子表达式用一个临时变量替换，实现值的复用

**内存别名**

不同的内存引用都指向同一个内存单元，引入局部变量保存计算的中间结果。

#### 三、串指令

**控制标志位**

> **DF - Direction Flag（方向标志位）**
>
> ​		控制串指令的数据传输方向（MOVS, CMPS, SCAS, LODS, STOS）
>
> ​		DF = 1，地址递减
>
> ​		DF = 0，地址递增

**STD / CLD指令**

STD：设置方向标志位（DF = 1）

CLD：清除方向标志位（DF = 0）

**REP / REPE / REPZ / REPNE / REPNZ指令**

重复串操作前缀

**MOVS指令**

串拷贝

**CMPS指令**

串比较

**LODS指令**

Load string

**STOS指令**

Store string

#### 四、MEMCPY优化

